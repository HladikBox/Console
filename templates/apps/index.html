{{include  file="$smarty_root/header.html" }}


<!-- =============================================== -->
<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <div class="row">
            <div class="col-md-10">
                <h2>
                    <i class="fa fa-th"></i> 我的应用({{$appcount+0}}/{{$Setting.max_created_apps}})
                    <small>您可以在这里创建、设置并管理您的应用</small>
                </h1>
            </div>
            <div class="col-md-2">
                <button type="button" class="btn btn-block btn-primary pull-right btnCreate">
                    <span class="glyphicon glyphicon-plus"></span>
                    创建新应用
                </button>
            </div>
        </div>
    </section>

    <!-- Main content -->
    <section class="content">
        {{if $appcount==0}}
        <div class="well ">
            <p>您还没有任何应用,先去<a href="#" class="btnCreate">新建一个应用</a>吧!</p>
        </div>
        {{else}}

          {{foreach from=$apps item=rs}}
          <div class="box box-primary collapsed-box box-solid">
            <div class="box-header with-border">
              <h3 class="box-title">
                {{$rs.name}}
              </h3>
              <h3 class="box-title">
                {{$rs.name}}
              </h3>

              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i>
                </button>
              </div>
              <!-- /.box-tools -->
            </div>
            <!-- /.box-header -->
            <div class="box-body">
              The body of the box
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->
        {{/foreach}}

        {{/if}}

    </section>
    <!-- /.content -->
</div>
<!-- /.content-wrapper -->

<div class="modal fade" id="dlgCreate">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-light-blue-active">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">创建应用</h4>
            </div>
            <div class="modal-body">、
                <div class="row">
                    <div class="col-md-10">
                        <form class="form-horizontal">
                            <div class="form-group" id="appname_fg">
                                <label  class="col-sm-3 control-label"><span style="color:red;">*</span> 应用名称</label>
                                <div class="col-sm-9">
                                    <input type="text" maxlength="15" class="form-control" id="appname" placeholder="应用名称不超过15个字">
                                </div>
                                <span class="help-block col-sm-offset-4"></span>
                            </div>
                            <div class="form-group" id="apptype_fg">
                                <label  class="col-sm-3 control-label"><span style="color:red;">*</span> 应用类型</label>
                                <div class="col-sm-9">
                                    <select class="form-control" id="apptype" >
                                        <option>请选择应用类型</option>
                                        {{foreach from=$app_type_list item=rs}}
                                        <option value="{{$rs.id}}">{{$rs.name}}</option>
                                        {{/foreach}}
                                    </select>
                                </div>
                                <span class="help-block col-sm-offset-4"></span>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default pull-left" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="btnCreatApp">创建</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->


{{include  file="$smarty_root/footer.html" }}

<script>
    $(document).ready(function () {
        $(".btnCreate").click(function () {
            $("#dlgCreate").modal("show");
        });

        $("#btnCreatApp").click(function () {

            var name = $("#appname").val();
            var type = $("#apptype").val();
            var json = {
                action: "createapp",
                name: name,
                type:type
            };
            $("#btnCreatApp").attr("disabled", true);
            $(".has-error .help-block").html("");
            $(".has-error").removeClass("has-error");

            $.post("{{$rootpath}}api/apps", json, function (data) {
                try{
                    data = JSON.parse(data);
                    if (data.code == 0) {
                        alert("添加成功");
                    } else if(data.code==-1) {
                        $("#" + data.return + "_fg").addClass("has-error");
                        $("#" + data.return + "_fg .help-block").html(data.result);
                    } 
                    
                }catch(e){
                    alert("系统错误，请联系管理员"+data);
                }
                $("#btnCreatApp").attr("disabled", false);
            });
        });

    });
    
</script>